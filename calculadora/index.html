<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mi primera Calculadora</title>

  <style>
    body{
      margin:0;
      font-family: Arial, sans-serif;
      background:#0b0f1a;
      color:#fff;
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
    }

    .calculadora{
      background:#13296e;
      padding:20px;
      border-radius:20px;
      width:320px;
    }

    .pantalla{
      background:#000;
      padding:15px;
      border-radius:10px;
      text-align:right;
      font-size:28px;
      margin-bottom:15px;
    }

    .historial{
      font-size:14px;
      opacity:0.6;
    }

    .botones{
      display:grid;
      grid-template-columns:repeat(4, 1fr);
      gap:10px;
    }

    button{
      padding:18px;
      font-size:18px;
      border:none;
      border-radius:10px;
      cursor:pointer;
    }

    .operador{background:#5c7aff; color:#000;}
    .accion{background:#ff6b6b; color:#000;}
    .igual{background:#00ffd1; color:#000;}

    .mensaje{
      position:fixed;
      bottom:20px;
      left:50%;
      transform:translateX(-50%);
      background:rgba(0,0,0,.7);
      padding:10px 15px;
      border-radius:10px;
      opacity:0;
      transition:.3s;
    }

    .mensaje.mostrar{
      opacity:1;
    }
  </style>
</head>
<body>

<div class="calculadora">

  <div class="pantalla">
    <div class="historial" id="historial">&nbsp;</div>
    <div id="resultado">0</div>
  </div>

  <div class="botones">
    <button class="accion" data-valor="C">C</button>
    <button class="accion" data-valor="Â±">Â±</button>
    <button class="operador" data-valor="%">%</button>
    <button class="operador" data-valor="/">Ã·</button>

    <button data-valor="7">7</button>
    <button data-valor="8">8</button>
    <button data-valor="9">9</button>
    <button class="operador" data-valor="*">Ã—</button>

    <button data-valor="4">4</button>
    <button data-valor="5">5</button>
    <button data-valor="6">6</button>
    <button class="operador" data-valor="-">âˆ’</button>

    <button data-valor="1">1</button>
    <button data-valor="2">2</button>
    <button data-valor="3">3</button>
    <button class="operador" data-valor="+">+</button>

    <button data-valor="0">0</button>
    <button data-valor=".">.</button>
    <button class="igual" data-valor="=">=</button>
    <button class="accion" data-valor="copiar">ðŸ“‹</button>
  </div>
</div>

<div class="mensaje" id="mensajeFlotante">Copiado</div>

<script>
  // ELEMENTOS
  const pantallaResultado = document.getElementById('resultado');
  const historialOperacion = document.getElementById('historial');
  const mensajeFlotante = document.getElementById('mensajeFlotante');
  const botones = document.querySelectorAll('button');

  // VARIABLES DE ESTADO
  let acumulador = null;        // primer nÃºmero
  let operacion = null;         // operaciÃ³n seleccionada
  let escribiendo = true;       // si se estÃ¡ escribiendo un nÃºmero
  let recienCalculado = false;  // si acaba de presionar =

  // FUNCIONES
  function mostrarMensaje(texto){
    mensajeFlotante.textContent = texto;
    mensajeFlotante.classList.add('mostrar');
    setTimeout(() => {
      mensajeFlotante.classList.remove('mostrar');
    }, 1000);
  }

  function obtenerNumero(){
    return parseFloat(pantallaResultado.textContent);
  }

  function actualizarPantalla(valor){
    pantallaResultado.textContent = valor;
  }

  function limpiarTodo(){
    acumulador = null;
    operacion = null;
    escribiendo = true;
    recienCalculado = false;
    historialOperacion.textContent = '';
    actualizarPantalla(0);
  }

  function escribirNumero(numero){
    if(recienCalculado){
      actualizarPantalla(numero);
      recienCalculado = false;
      return;
    }

    if(escribiendo){
      if(pantallaResultado.textContent === '0'){
        actualizarPantalla(numero);
      } else {
        actualizarPantalla(pantallaResultado.textContent + numero);
      }
    } else {
      actualizarPantalla(numero);
      escribiendo = true;
    }
  }

  function calcular(x, y, op){
    if(op === '+') return x + y;
    if(op === '-') return x - y;
    if(op === '*') return x * y;
    if(op === '/') return y === 0 ? 'Error' : x / y;
    return y;
  }

  function seleccionarOperacion(op){
    const actual = obtenerNumero();

    if(acumulador === null){
      acumulador = actual;
    } else {
      acumulador = calcular(acumulador, actual, operacion);
      actualizarPantalla(acumulador);
    }

    operacion = op;
    escribiendo = false;
    historialOperacion.textContent = acumulador + ' ' + op;
  }

  function resultadoFinal(){
    const actual = obtenerNumero();
    const resultado = calcular(acumulador, actual, operacion);
    actualizarPantalla(resultado);
    historialOperacion.textContent = '';
    acumulador = resultado;
    operacion = null;
    recienCalculado = true;
  }

  function cambiarSigno(){
    actualizarPantalla(obtenerNumero() * -1);
  }

  function porcentaje(){
    actualizarPantalla(obtenerNumero() / 100);
  }

  function copiarResultado(){
    navigator.clipboard.writeText(pantallaResultado.textContent);
    mostrarMensaje('Copiado al portapapeles');
  }

  // EVENTOS
  botones.forEach(boton => {
    boton.addEventListener('click', () => {
      const valor = boton.dataset.valor;

      if(!isNaN(valor) || valor === '.'){
        escribirNumero(valor);
      }
      else if(valor === 'C'){
        limpiarTodo();
      }
      else if(valor === 'Â±'){
        cambiarSigno();
      }
      else if(valor === '%'){
        porcentaje();
      }
      else if(valor === '='){
        resultadoFinal();
      }
      else if(valor === 'copiar'){
        copiarResultado();
      }
      else{
        seleccionarOperacion(valor);
      }
    });
  });

  limpiarTodo();
</script>

</body>
</html>